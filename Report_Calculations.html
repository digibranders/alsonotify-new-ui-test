<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports Module Calculations</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            border-bottom: 2px solid #eaeaea;
            padding-bottom: 10px;
        }

        h2 {
            color: #0066cc;
            margin-top: 40px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        h3 {
            color: #555;
            border-left: 4px solid #0066cc;
            padding-left: 10px;
            margin-top: 25px;
        }

        code {
            background: #f4f4f4;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: monospace;
            color: #d63384;
        }

        .formula-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 1.1em;
            color: #333;
        }

        .example-box {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .note {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .tab-section {
            margin-bottom: 50px;
        }
    </style>
</head>

<body>

    <h1>Reports Module Calculations</h1>
    <p>This document details the formulas, KPIs, and column calculations used across the <strong>Reports</strong> module
        tabs: <strong>Requirements</strong>, <strong>Tasks</strong>, and <strong>Employees</strong>.</p>

    <!-- TAB 1: REQUIREMENTS -->
    <div class="tab-section">
        <h2>Tab 1: Requirements</h2>
        <p>Focuses on project/requirement level performance, tracking time utilization and revenue generation.</p>

        <h3>KPI Definitions</h3>
        <ul>
            <li><strong>Total Requirements:</strong> Count of requirements matching the current filters.</li>
            <li><strong>On Time Completed:</strong> Count of requirements with status 'Completed' where
                <code>EndDate &le; DueDate</code>.</li>
            <li><strong>In Progress:</strong> Count of currently active requirements.</li>
            <li><strong>Delayed:</strong> Count of requirements that are past their due date or explicitly marked as
                'Delayed'.
                <ul>
                    <li>Currently displays <strong>Total Extra Hours</strong> incurred across delayed requirements.</li>
                </ul>
            </li>
            <li><strong>Avg. Efficiency:</strong> The average efficiency score across all filtered requirements.</li>
        </ul>

        <h3>Column Calculations</h3>

        <h4>1. Hours Utilization (Bar)</h4>
        <p><b>Definition:</b> The percentage of allotted hours that have been consumed.</p>
        <div class="formula-box">
            Utilization % = (Engaged Hours / Allotted Hours) * 100
        </div>
        <p class="note">If Engaged Hours > Allotted Hours, the bar turns <strong>Red</strong> to indicate over-budget
            usage.</p>

        <h4>2. Revenue</h4>
        <p><b>Definition:</b> Total revenue generated by the requirement for the selected period.</p>
        <div class="formula-box">
            Requirement Revenue = &sum; (Employee Revenue Contributions)
        </div>
        <p>See the <em>Employees > Revenue</em> section below for the detailed "Pro-rated Fixed Price" logic used to
            calculate individual revenue contributions.</p>
    </div>

    <!-- TAB 2: TASKS -->
    <div class="tab-section">
        <h2>Tab 2: Tasks</h2>
        <p>Focuses on individual task execution, tracking estimated vs. actual time.</p>

        <h3>KPI Definitions</h3>
        <ul>
            <li><strong>Total Tasks:</strong> Total number of tasks matching filters.</li>
            <li><strong>On Time Completed:</strong> Tasks completed on or before the due date.</li>
            <li><strong>Delayed:</strong> Tasks overdue or marked delayed. Includes sum of <code>Extra Hours</code>.
            </li>
            <li><strong>Avg. Efficiency:</strong> Average efficiency score across tasks.</li>
        </ul>

        <h3>Column Calculations</h3>

        <h4>1. Extra Hours</h4>
        <p><b>Definition:</b> The amount of time spent exceeding the original estimate.</p>
        <div class="formula-box">
            Extra Hours = MAX(0, Engaged Hours - Allotted Hours)
        </div>
        <div class="example-box">
            <strong>Example:</strong><br>
            Allotted: 10h<br>
            Engaged: 12h<br>
            <strong>Extra = 2h</strong> (Displayed in Red)
        </div>
    </div>

    <!-- TAB 3: EMPLOYEES -->
    <div class="tab-section">
        <h2>Tab 3: Employees</h2>
        <p>Focuses on resource performance, financial metrics, and utilization.</p>

        <h3>KPI Definitions (Client-Side Aggregation)</h3>
        <p>These totals are calculated dynamically based on the filtered list of employees.</p>

        <div class="formula-box">
            <strong>Total Investment</strong> = &sum; (Employee Investment)<br>
            <strong>Total Revenue</strong> = &sum; (Employee Revenue)<br>
            <strong>Net Profit</strong> = Total Revenue - Total Investment<br>
            <strong>Avg. Rate/Hr</strong> = Total Revenue / Total Engaged Hours
        </div>

        <h3>Detailed Column Formulas</h3>

        <h4>1. Utilization (%)</h4>
        <p><b>Definition:</b> Percentage of available capacity used for worklogs.</p>
        <div class="formula-box">
            Utilization = (Engaged Hours / Period Capacity) * 100
        </div>
        <ul>
            <li><strong>Period Capacity:</strong> Working Days in Range &times; Daily Hours (usually 8).</li>
            <li><strong>Engaged Hours:</strong> Total hours logged by the employee in the selected range.</li>
        </ul>

        <h4>2. Investment</h4>
        <p><b>Definition:</b> Cost incurred by the company for the employee's time.</p>
        <div class="formula-box">
            Investment = Engaged Hours &times; Hourly Cost
        </div>
        <p><strong>Hourly Cost Calculation:</strong> <code>Annual Salary / Annual Working Hours</code></p>
        <ul>
            <li>Uses dynamic working days based on company profile (e.g., 5 vs 6 day weeks).</li>
            <li>Deducts Public Holidays and Leaves (if configured) to find true working hours.</li>
        </ul>

        <h4>3. Revenue (Attributed)</h4>
        <p><b>Definition:</b> Revenue attributed to the employee based on their contribution to projects.</p>
        <p>The system uses a <strong>"Pro-rated Fixed Price"</strong> model for Fixed Price projects:</p>
        <div class="formula-box">
            1. Req Revenue (Period) = (Quoted Price / Total Req Duration) &times; Overlap Days<br>
            2. Employee Revenue = Req Revenue (Period) &times; (Employee Log Hours / Total Team Log Hours in Period)
        </div>
        <div class="example-box">
            <strong>Example:</strong><br>
            Project Price: $10,000 over 60 days.<br>
            Selected Jan (30 days) &rarr; Period Revenue allocated = $5,000.<br>
            Employee did 25% of the total work in Jan.<br>
            <strong>Employee Revenue = $5,000 * 0.25 = $1,250</strong>
        </div>
        <p class="note"><strong>Fallback:</strong> For T&M projects or missing fixed price data:
            <code>Revenue = Engaged Hours &times; Billable Rate</code>.</p>

        <h4>4. Profit</h4>
        <div class="formula-box">
            Profit = Revenue - Investment
        </div>

        <h4>5. Drawer Stats: Efficiency / Task Completion Rate</h4>
        <p>Visible when clicking an employee row.</p>
        <div class="formula-box">
            Efficiency = (Tasks Completed / Tasks Assigned) * 100
        </div>
        <ul>
            <li><strong>Green:</strong> &ge; 90%</li>
            <li><strong>Blue:</strong> &ge; 75%</li>
            <li><strong>Red:</strong> &lt; 75%</li>
        </ul>
    </div>

</body>

</html>