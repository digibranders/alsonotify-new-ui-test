<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Requirements Workflow Specification - AlsoNotify</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --accent-red: #FF3B3B;
            --accent-green: #3fb950;
            --accent-blue: #58a6ff;
            --accent-orange: #d29922;
            --accent-purple: #a371f7;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border-color: #30363d;
            --card-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        header {
            text-align: center;
            margin-bottom: 80px;
            padding-bottom: 40px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-red), #ff6b6b);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
        }

        h1 {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -1.5px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            color: var(--text-secondary);
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        .meta-info {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-top: 24px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .meta-info span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-red { background: rgba(255, 59, 59, 0.15); color: var(--accent-red); }
        .badge-green { background: rgba(63, 185, 80, 0.15); color: var(--accent-green); }
        .badge-blue { background: rgba(88, 166, 255, 0.15); color: var(--accent-blue); }
        .badge-orange { background: rgba(210, 153, 34, 0.15); color: var(--accent-orange); }
        .badge-purple { background: rgba(163, 113, 247, 0.15); color: var(--accent-purple); }

        section {
            margin-bottom: 80px;
        }

        h2 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h2::before {
            content: '';
            width: 4px;
            height: 28px;
            background: var(--accent-red);
            border-radius: 2px;
        }

        h3 {
            font-size: 20px;
            font-weight: 600;
            margin: 32px 0 16px;
            color: var(--text-primary);
        }

        h4 {
            font-size: 16px;
            font-weight: 600;
            margin: 24px 0 12px;
            color: var(--text-secondary);
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--card-shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .diagram-container {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 32px;
            margin: 24px 0;
            overflow-x: auto;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 14px;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 13px;
            color: var(--accent-blue);
        }

        pre {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.7;
        }

        pre code {
            background: none;
            padding: 0;
            color: var(--text-primary);
        }

        .comment { color: var(--text-muted); }
        .keyword { color: var(--accent-purple); }
        .string { color: var(--accent-green); }
        .type { color: var(--accent-orange); }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        @media (max-width: 900px) {
            .grid-2 { grid-template-columns: 1fr; }
        }

        .status-flow {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin: 12px 0;
        }

        .status-pill {
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .arrow {
            color: var(--text-muted);
            font-size: 18px;
        }

        .role-section {
            border-left: 3px solid var(--border-color);
            padding-left: 20px;
            margin: 20px 0;
        }

        .role-section.sender { border-color: var(--accent-blue); }
        .role-section.receiver { border-color: var(--accent-orange); }
        .role-section.internal { border-color: var(--accent-green); }

        .highlight-box {
            background: rgba(255, 59, 59, 0.08);
            border: 1px solid rgba(255, 59, 59, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .highlight-box h4 {
            color: var(--accent-red);
            margin-top: 0;
        }

        .toc {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 40px;
        }

        .toc h3 {
            margin-top: 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }

        .toc ul {
            list-style: none;
            padding: 0;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            display: block;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .toc a:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .implementation-step {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: 12px;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: var(--accent-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            margin-top: 0;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">AN</div>
                <span style="font-size: 24px; font-weight: 700;">AlsoNotify</span>
            </div>
            <h1>Requirements Workflow Specification</h1>
            <p>A comprehensive technical specification for the requirements module workflow, state management, and CTA mapping across sender/receiver roles.</p>
            <div class="meta-info">
                <span><strong>Version:</strong> 2.0</span>
                <span><strong>Last Updated:</strong> January 2026</span>
                <span><strong>Status:</strong> <span class="badge badge-green">Production Ready</span></span>
            </div>
        </header>

        <!-- Table of Contents -->
        <div class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#overview">1. System Overview</a></li>
                <li><a href="#state-machine">2. State Machine Definition</a></li>
                <li><a href="#outsourced-flow">3. Outsourced Requirements Workflow</a></li>
                <li><a href="#internal-flow">4. Internal Requirements Workflow</a></li>
                <li><a href="#task-relationship">5. Requirement-Task Relationship</a></li>
                <li><a href="#cta-mapping">6. CTA Mapping Specification</a></li>
                <li><a href="#modal-config">7. Modal Configuration</a></li>
                <li><a href="#implementation">8. Implementation Guide</a></li>
            </ul>
        </div>

        <!-- Section 1: Overview -->
        <section id="overview">
            <h2>System Overview</h2>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Requirement Types</div>
                        <div class="card-subtitle">Three distinct requirement types with different workflow paths</div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="role-section sender">
                        <h4>Outsourced Requirements</h4>
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            Cross-company collaboration between a <strong>Sender (Client)</strong> and <strong>Receiver (Vendor)</strong>.
                            Involves quotation flow, workspace mapping, and work review cycles.
                        </p>
                        <div class="status-flow">
                            <span class="badge badge-blue">Waiting</span>
                            <span class="arrow">→</span>
                            <span class="badge badge-orange">Submitted</span>
                            <span class="arrow">→</span>
                            <span class="badge badge-green">Assigned</span>
                            <span class="arrow">→</span>
                            <span class="badge badge-purple">In_Progress</span>
                            <span class="arrow">→</span>
                            <span class="badge badge-blue">Review</span>
                            <span class="arrow">→</span>
                            <span class="badge badge-green">Completed</span>
                        </div>
                        <div class="status-flow" style="margin-top: 8px;">
                            <span style="color: var(--text-muted); font-size: 12px; margin-right: 8px;">Exception:</span>
                            <span class="badge badge-red">Delayed</span>
                        </div>
                    </div>
                    
                    <div class="role-section internal">
                        <h4>Internal / In-house Requirements</h4>
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            Single-company workflow with internal team assignment and execution.
                            Simpler flow without partner coordination.
                        </p>
                        <div class="status-flow">
                            <span class="badge badge-green">Assigned</span>
                            <span class="arrow">→</span>
                            <span class="badge badge-purple">In_Progress</span>
                            <span class="arrow">→</span>
                            <span class="badge badge-blue">Review</span>
                            <span class="arrow">→</span>
                            <span class="badge badge-green">Completed</span>
                        </div>
                        <div class="status-flow" style="margin-top: 8px;">
                            <span style="color: var(--text-muted); font-size: 12px; margin-right: 8px;">Exception:</span>
                            <span class="badge badge-red">Delayed</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Role Definitions</div>
                <table>
                    <thead>
                        <tr>
                            <th>Role</th>
                            <th>Context</th>
                            <th>Determination Logic</th>
                            <th>Primary Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td>Outsourced</td>
                            <td><code>sender_company_id === currentUser.company_id</code></td>
                            <td>Create requirement, review quotes, approve work</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td>Outsourced</td>
                            <td><code>receiver_company_id === currentUser.company_id</code></td>
                            <td>Submit quotes, map workspace, execute work</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">Internal</span></td>
                            <td>In-house</td>
                            <td><code>!receiver_company_id && workspace.company_id === user.company_id</code></td>
                            <td>Full lifecycle management</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 2: State Machine -->
        <section id="state-machine">
            <h2>State Machine Definition</h2>
            
            <div class="card">
                <div class="card-title">Complete Status Enumeration</div>
                <div class="card-subtitle">All possible requirement statuses from Prisma schema</div>
                
                <div class="diagram-container">
                    <pre><code><span class="keyword">enum</span> <span class="type">RequirementStatus</span> {
  <span class="string">Assigned</span>      <span class="comment">// Initial state after creation or quote acceptance</span>
  <span class="string">Waiting</span>       <span class="comment">// Outsourced: Waiting for vendor quote</span>
  <span class="string">Submitted</span>     <span class="comment">// Outsourced: Quote submitted by vendor</span>
  <span class="string">In_Progress</span>   <span class="comment">// Work actively being done</span>
  <span class="string">Review</span>        <span class="comment">// Work submitted for review</span>
  <span class="string">Revision</span>      <span class="comment">// Work rejected, needs revision</span>
  <span class="string">Completed</span>     <span class="comment">// Work approved, requirement fulfilled</span>
  <span class="string">Rejected</span>      <span class="comment">// Quote or requirement rejected</span>
  <span class="string">On_Hold</span>       <span class="comment">// Temporarily paused</span>
  <span class="string">Delayed</span>       <span class="comment">// Behind schedule</span>
  <span class="string">Impediment</span>    <span class="comment">// Blocked by external factor</span>
  <span class="string">Stuck</span>         <span class="comment">// Blocked internally</span>
  <span class="string">Archived</span>      <span class="comment">// Soft deleted / historical</span>
  <span class="string">draft</span>         <span class="comment">// Not yet submitted</span>
}</code></pre>
                </div>
            </div>

            <div class="card">
                <div class="card-title">State Transition Diagram - Outsourced Requirements</div>
                
                <div class="diagram-container">
                    <div class="mermaid">
stateDiagram-v2
    [*] --> Waiting: Sender creates requirement
    
    state "Quote Flow" as QuoteFlow {
        Waiting --> Submitted: Receiver submits quote
        Waiting --> Rejected: Receiver declines
        Submitted --> Assigned: Sender accepts quote
        Submitted --> Rejected: Sender rejects quote
        Submitted --> Waiting: Receiver retracts quote
        Rejected --> Submitted: Receiver revises quote
        Rejected --> Waiting: Sender edits and resends
    }
    
    state "Work Flow" as WorkFlow {
        Assigned --> In_Progress: Receiver starts work
        In_Progress --> Review: Receiver submits work
        In_Progress --> Impediment: External blocker
        In_Progress --> Stuck: Internal blocker
        In_Progress --> On_Hold: Pause work
        Review --> Completed: Sender approves
        Review --> Revision: Sender requests changes
        Review --> In_Progress: Receiver pulls back
        Revision --> In_Progress: Continue work
        Revision --> Review: Resubmit work
    }
    
    state "Recovery" as Recovery {
        Impediment --> In_Progress: Unblocked
        Stuck --> In_Progress: Unblocked
        On_Hold --> In_Progress: Resume
    }
    
    Completed --> [*]
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Outsourced Flow -->
        <section id="outsourced-flow">
            <h2>Outsourced Requirements Workflow</h2>
            
            <div class="card">
                <div class="card-title">Sequence Diagram - Complete Outsourced Flow</div>
                <div class="card-subtitle">End-to-end communication between Sender and Receiver</div>
                
                <div class="diagram-container">
                    <div class="mermaid">
sequenceDiagram
    autonumber
    participant S as Sender (Company A)
    participant SYS as System
    participant R as Receiver (Company B)
    
    Note over S,R: Phase 1: Quote Flow
    S->>SYS: Create Outsourced Requirement
    SYS->>SYS: Status = Waiting
    SYS-->>R: Notification: New requirement received
    
    alt Receiver Accepts
        R->>SYS: Submit Quotation (price, terms)
        SYS->>SYS: Status = Submitted
        SYS-->>S: Notification: Quote received
        
        alt Sender Accepts Quote
            S->>SYS: Accept Quote
            SYS->>SYS: Status = Assigned
            SYS-->>R: Notification: Quote accepted
        else Sender Rejects Quote
            S->>SYS: Reject Quote (reason)
            SYS->>SYS: Status = Rejected
            SYS-->>R: Notification: Quote rejected
            R->>SYS: Revise & Resubmit Quote
            SYS->>SYS: Status = Submitted
        end
    else Receiver Declines
        R->>SYS: Decline Requirement (reason)
        SYS->>SYS: Status = Rejected
        SYS-->>S: Notification: Requirement declined
    end
    
    Note over S,R: Phase 2: Workspace Mapping
    R->>SYS: Map to Internal Workspace
    SYS->>SYS: receiver_workspace_id = selected
    
    Note over S,R: Phase 3: Work Execution
    R->>SYS: Start Work
    SYS->>SYS: Status = In_Progress
    
    loop Work Cycle
        R->>SYS: Update Progress / Tasks
        SYS-->>S: Progress updates visible
    end
    
    R->>SYS: Submit Work for Review
    SYS->>SYS: Status = Review
    SYS-->>S: Notification: Work ready for review
    
    alt Sender Approves
        S->>SYS: Approve Work
        SYS->>SYS: Status = Completed
        SYS-->>R: Notification: Work approved
    else Sender Requests Revision
        S->>SYS: Request Revision (feedback)
        SYS->>SYS: Status = Revision
        SYS-->>R: Notification: Revision requested
        R->>SYS: Continue and Resubmit
        SYS->>SYS: Status = Review
    end
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Sender Transitions</div>
                            <span class="badge badge-blue">Company A (Client)</span>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>From Status</th>
                                <th>Allowed Transitions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>Waiting</code></td>
                                <td><code>On_Hold</code>, <code>Rejected</code></td>
                            </tr>
                            <tr>
                                <td><code>Submitted</code></td>
                                <td><code>Assigned</code>, <code>Rejected</code></td>
                            </tr>
                            <tr>
                                <td><code>Review</code></td>
                                <td><code>Completed</code>, <code>Revision</code></td>
                            </tr>
                            <tr>
                                <td><code>Rejected</code></td>
                                <td><code>Waiting</code> (resend)</td>
                            </tr>
                            <tr>
                                <td><code>Completed</code></td>
                                <td><code>Revision</code>, <code>Rejected</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Receiver Transitions</div>
                            <span class="badge badge-orange">Company B (Vendor)</span>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>From Status</th>
                                <th>Allowed Transitions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>Waiting</code></td>
                                <td><code>Submitted</code>, <code>Rejected</code></td>
                            </tr>
                            <tr>
                                <td><code>Submitted</code></td>
                                <td><code>Waiting</code> (retract)</td>
                            </tr>
                            <tr>
                                <td><code>Rejected</code></td>
                                <td><code>Submitted</code> (revise quote)</td>
                            </tr>
                            <tr>
                                <td><code>Assigned</code></td>
                                <td><code>In_Progress</code></td>
                            </tr>
                            <tr>
                                <td><code>In_Progress</code></td>
                                <td><code>Review</code>, <code>Impediment</code>, <code>Stuck</code>, <code>On_Hold</code></td>
                            </tr>
                            <tr>
                                <td><code>Review</code></td>
                                <td><code>In_Progress</code> (pull back)</td>
                            </tr>
                            <tr>
                                <td><code>Revision</code></td>
                                <td><code>Review</code>, <code>In_Progress</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Section 4: Internal Flow -->
        <section id="internal-flow">
            <h2>Internal Requirements Workflow</h2>
            
            <div class="card">
                <div class="card-title">State Transition Diagram - Internal Requirements</div>
                
                <div class="diagram-container">
                    <div class="mermaid">
stateDiagram-v2
    [*] --> Assigned: Create Requirement
    
    Assigned --> In_Progress: Start Work
    Assigned --> On_Hold: Pause
    
    In_Progress --> Review: Submit for Review
    In_Progress --> Completed: Direct Complete
    In_Progress --> Impediment: External Block
    In_Progress --> Stuck: Internal Block
    In_Progress --> On_Hold: Pause
    
    Review --> Completed: Approve
    Review --> Revision: Request Changes
    Review --> Assigned: Reassign
    Review --> Rejected: Reject
    
    Revision --> In_Progress: Resume
    Revision --> Review: Resubmit
    
    Impediment --> In_Progress: Unblock
    Stuck --> In_Progress: Unblock
    On_Hold --> In_Progress: Resume
    On_Hold --> Assigned: Reassign
    
    Completed --> Revision: Reopen
    Completed --> Assigned: Full Reopen
    
    Rejected --> Assigned: Restart
    
    Completed --> [*]
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Internal Transitions Table</div>
                <table>
                    <thead>
                        <tr>
                            <th>From Status</th>
                            <th>Allowed Transitions</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Assigned</code></td>
                            <td><code>In_Progress</code>, <code>On_Hold</code></td>
                            <td>Initial active state</td>
                        </tr>
                        <tr>
                            <td><code>In_Progress</code></td>
                            <td><code>Review</code>, <code>Completed</code>, <code>Impediment</code>, <code>Stuck</code>, <code>On_Hold</code></td>
                            <td>Main work state</td>
                        </tr>
                        <tr>
                            <td><code>Review</code></td>
                            <td><code>Assigned</code>, <code>Completed</code>, <code>Revision</code>, <code>Rejected</code></td>
                            <td>Quality gate</td>
                        </tr>
                        <tr>
                            <td><code>Revision</code></td>
                            <td><code>In_Progress</code>, <code>Review</code></td>
                            <td>Rework cycle</td>
                        </tr>
                        <tr>
                            <td><code>Completed</code></td>
                            <td><code>Revision</code>, <code>Assigned</code></td>
                            <td>Reopen if needed</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 5: Requirement-Task Relationship -->
        <section id="task-relationship">
            <h2>Requirement-Task Relationship</h2>
            
            <div class="highlight-box">
                <h4>Key Concept: Status Rollup</h4>
                <p style="color: var(--text-secondary); font-size: 14px;">
                    Once a requirement reaches <code>In_Progress</code> status, work is executed through <strong>Tasks</strong>.
                    Task statuses automatically "roll up" to determine the parent requirement's status via the <code>rollupRequirementStatus()</code> function.
                    This creates a hierarchical workflow where granular task progress drives requirement-level status.
                </p>
            </div>

            <div class="card">
                <div class="card-title">Hierarchy Diagram</div>
                <div class="card-subtitle">Requirements contain Tasks, Tasks contain Members</div>
                
                <div class="diagram-container">
                    <div class="mermaid">
flowchart TB
    subgraph Requirement [Requirement Level]
        R[Requirement]
        RS[Status: Assigned/In_Progress/Review/Revision/Completed]
    end
    
    subgraph Tasks [Task Level]
        T1[Task 1]
        T2[Task 2]
        T3[Task 3 - Revision]
    end
    
    subgraph Members [Member Level]
        M1[Member A]
        M2[Member B]
        M3[Member C]
    end
    
    R --> T1
    R --> T2
    R --> T3
    T1 --> M1
    T1 --> M2
    T2 --> M3
    
    RS -.->|rollup| T1
    RS -.->|rollup| T2
    RS -.->|rollup| T3
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Status Rollup Logic</div>
                <div class="card-subtitle">How task statuses determine requirement status</div>
                
                <div class="diagram-container">
                    <div class="mermaid">
flowchart TD
    Start[Task Status Change] --> Check1{Any Revision Task Active?}
    Check1 -->|Yes| Revision[Requirement = Revision]
    Check1 -->|No| Check2{All Tasks Completed?}
    Check2 -->|Yes| Review[Requirement = Review]
    Check2 -->|No| Check3{Any Task In_Progress?}
    Check3 -->|Yes| InProgress[Requirement = In_Progress]
    Check3 -->|No| Assigned[Requirement = Assigned]
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Task Condition</th>
                            <th>Resulting Requirement Status</th>
                            <th>Priority</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Any revision task is active (not completed)</td>
                            <td><code>Revision</code></td>
                            <td><span class="badge badge-red">Highest</span></td>
                        </tr>
                        <tr>
                            <td>All tasks are completed</td>
                            <td><code>Review</code></td>
                            <td><span class="badge badge-orange">High</span></td>
                        </tr>
                        <tr>
                            <td>Any task is in progress</td>
                            <td><code>In_Progress</code></td>
                            <td><span class="badge badge-blue">Medium</span></td>
                        </tr>
                        <tr>
                            <td>No tasks or all assigned</td>
                            <td><code>Assigned</code></td>
                            <td><span class="badge badge-green">Default</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <div class="card-title">Task Status Workflow</div>
                <div class="card-subtitle">Valid transitions for individual tasks (from TaskWorkflowManager)</div>
                
                <div class="diagram-container">
                    <div class="mermaid">
stateDiagram-v2
    [*] --> Assigned: Task Created
    
    Assigned --> In_Progress: Start Work
    Assigned --> Delayed: Schedule Issue
    
    In_Progress --> Completed: Finish
    In_Progress --> Review: Submit for Review
    In_Progress --> Stuck: Internal Block
    In_Progress --> Impediment: External Block
    In_Progress --> Delayed: Schedule Issue
    
    Review --> Completed: Approve
    Review --> In_Progress: Need Changes
    Review --> Stuck: Block Found
    
    Stuck --> In_Progress: Unblocked
    Stuck --> Impediment: Escalate
    
    Impediment --> In_Progress: Resolved
    Impediment --> Stuck: Downgrade
    
    Delayed --> Assigned: Reschedule
    Delayed --> In_Progress: Resume
    
    Completed --> Review: Reopen
    
    Completed --> [*]
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>From Status</th>
                            <th>Allowed Transitions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Assigned</code></td>
                            <td><code>In_Progress</code>, <code>Delayed</code></td>
                        </tr>
                        <tr>
                            <td><code>In_Progress</code></td>
                            <td><code>Completed</code>, <code>Review</code>, <code>Stuck</code>, <code>Impediment</code>, <code>Delayed</code></td>
                        </tr>
                        <tr>
                            <td><code>Review</code></td>
                            <td><code>Completed</code>, <code>In_Progress</code>, <code>Stuck</code></td>
                        </tr>
                        <tr>
                            <td><code>Stuck</code></td>
                            <td><code>In_Progress</code>, <code>Impediment</code></td>
                        </tr>
                        <tr>
                            <td><code>Impediment</code></td>
                            <td><code>In_Progress</code>, <code>Stuck</code></td>
                        </tr>
                        <tr>
                            <td><code>Delayed</code></td>
                            <td><code>Assigned</code>, <code>In_Progress</code></td>
                        </tr>
                        <tr>
                            <td><code>Completed</code></td>
                            <td><code>Review</code> (reopen)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <div class="card-title">Sequence: Work Execution Phase</div>
                <div class="card-subtitle">What happens after requirement status becomes In_Progress</div>
                
                <div class="diagram-container">
                    <div class="mermaid">
sequenceDiagram
    autonumber
    participant R as Requirement
    participant T as Tasks
    participant M as Task Members
    participant SYS as System
    
    Note over R,M: Phase: Work Execution (Status = In_Progress)
    
    R->>T: Create Tasks under Requirement
    T->>M: Assign Members to Tasks
    
    loop Task Execution
        M->>T: Update Member Status (In_Progress)
        T->>SYS: Aggregate Member Statuses
        SYS->>T: Calculate Task Status
        T->>R: Trigger rollupRequirementStatus()
        SYS->>R: Update Requirement Status
    end
    
    Note over R,M: All Tasks Completed
    M->>T: Last Member marks Completed
    T->>SYS: All tasks now Completed
    SYS->>R: Status = Review
    
    Note over R,M: Sender Reviews Work
    alt Approved
        R->>R: Status = Completed
    else Revision Requested
        R->>T: Create Revision Task
        T->>M: Assign to Member
        SYS->>R: Status = Revision
        M->>T: Complete Revision
        SYS->>R: Status = Review
    end
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-title">Revision Task Flow</div>
                    <div class="card-subtitle">When sender requests changes after review</div>
                    
                    <h4>Trigger</h4>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        Sender reviews completed work and requests revision with feedback notes.
                    </p>
                    
                    <h4>System Actions</h4>
                    <ul style="color: var(--text-secondary); font-size: 14px; padding-left: 20px;">
                        <li>Create new Task with <code>is_revision = true</code></li>
                        <li>Link to original task via <code>parent_id</code></li>
                        <li>Auto-generate display_id: <code>rev-001</code>, <code>rev-002</code></li>
                        <li>Copy original task members</li>
                        <li>Rollup triggers: Requirement → <code>Revision</code></li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-title">Member Status Aggregation</div>
                    <div class="card-subtitle">How member statuses determine task status</div>
                    
                    <h4>Priority Order (Highest First)</h4>
                    <ol style="color: var(--text-secondary); font-size: 14px; padding-left: 20px;">
                        <li><code>Stuck</code> - Any member stuck → Task stuck</li>
                        <li><code>Impediment</code> - Any blocked → Task blocked</li>
                        <li><code>In_Progress</code> - Any active → Task active</li>
                        <li><code>Completed</code> - ALL must be done</li>
                        <li><code>Review</code> - Any in review</li>
                        <li><code>Delayed</code> - Any delayed</li>
                        <li><code>Assigned</code> - Default fallback</li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- Section 6: CTA Mapping -->
        <section id="cta-mapping">
            <h2>CTA Mapping Specification</h2>
            
            <div class="highlight-box">
                <h4>Key Principle</h4>
                <p style="color: var(--text-secondary); font-size: 14px;">
                    The Call-to-Action (CTA) shown to a user depends on three factors:
                    <strong>(1) Current Status</strong>, <strong>(2) User Role</strong> (Sender/Receiver/Internal), and <strong>(3) Additional Context</strong> (e.g., is workspace mapped?).
                    This logic should be centralized in a workflow module, not scattered across components.
                </p>
            </div>

            <div class="card">
                <div class="card-title">CTA Matrix - Outsourced Requirements</div>
                <table>
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Role</th>
                            <th>Tab</th>
                            <th>Display Status</th>
                            <th>Primary CTA</th>
                            <th>Secondary CTA</th>
                            <th>Modal Triggered</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Waiting</code></td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Awaiting Quote...</td>
                            <td>-</td>
                            <td>Cancel</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Waiting</code></td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Action Needed: Submit Quote</td>
                            <td>Submit Quote</td>
                            <td>Decline</td>
                            <td>QuotationDialog</td>
                        </tr>
                        <tr>
                            <td><code>Submitted</code></td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Quote Received</td>
                            <td>Accept Quote</td>
                            <td>Reject Quote</td>
                            <td>Direct API / RejectDialog</td>
                        </tr>
                        <tr>
                            <td><code>Submitted</code></td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Quote Submitted. Pending...</td>
                            <td>-</td>
                            <td>Retract</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Rejected</code> (by Receiver)</td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span style="background: rgba(110, 118, 129, 0.15); color: #8b949e; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">Draft</span></td>
                            <td>Requirement Rejected</td>
                            <td>Edit & Resend</td>
                            <td>-</td>
                            <td>RequirementsForm</td>
                        </tr>
                        <tr>
                            <td><code>Rejected</code> (by Sender - Quote)</td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span style="background: rgba(110, 118, 129, 0.15); color: #8b949e; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">Draft</span></td>
                            <td>Quote Rejected. Awaiting Revision...</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Rejected</code> (by Sender - Quote)</td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Quote Rejected</td>
                            <td>Revise Quote</td>
                            <td>-</td>
                            <td>QuotationDialog</td>
                        </tr>
                        <tr>
                            <td><code>Rejected</code> (by Receiver)</td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Requirement Declined. Awaiting Edit...</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Assigned</code> (unmapped)</td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Action Needed: Map Workspace</td>
                            <td>Map Workspace</td>
                            <td>-</td>
                            <td>InternalMappingModal</td>
                        </tr>
                        <tr>
                            <td><code>Assigned</code> (mapped)</td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-purple">Active</span></td>
                            <td>Ready to Start</td>
                            <td>Start Work</td>
                            <td>-</td>
                            <td>Direct API</td>
                        </tr>
                        <tr>
                            <td><code>In_Progress</code></td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span class="badge badge-purple">Active</span></td>
                            <td>Work In Progress...</td>
                            <td>-</td>
                            <td>Pause</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>In_Progress</code></td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-purple">Active</span></td>
                            <td>Work In Progress</td>
                            <td>Submit for Review</td>
                            <td>Mark Blocked</td>
                            <td>Direct API</td>
                        </tr>
                        <tr>
                            <td><code>Review</code></td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Work Completed. Review Needed.</td>
                            <td>Approve Work</td>
                            <td>Request Revision</td>
                            <td>Direct API / RejectDialog</td>
                        </tr>
                        <tr>
                            <td><code>Review</code></td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-orange">Pending</span></td>
                            <td>Work Submitted. Pending Review...</td>
                            <td>-</td>
                            <td>Pull Back</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Revision</code></td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span class="badge badge-purple">Active</span></td>
                            <td>Revision In Progress...</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Revision</code></td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-purple">Active</span></td>
                            <td>Revision Requested</td>
                            <td>Resubmit Work</td>
                            <td>-</td>
                            <td>Direct API</td>
                        </tr>
                        <tr>
                            <td><code>Completed</code></td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span class="badge badge-green">Completed</span></td>
                            <td>Completed</td>
                            <td>-</td>
                            <td>Reopen</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Completed</code></td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-green">Completed</span></td>
                            <td>Completed</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Delayed</code></td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span class="badge badge-red">Delayed</span></td>
                            <td>Delayed</td>
                            <td>-</td>
                            <td>Resume</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>Delayed</code></td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-red">Delayed</span></td>
                            <td>Delayed</td>
                            <td>Resume Work</td>
                            <td>-</td>
                            <td>Direct API</td>
                        </tr>
                        <tr>
                            <td><code>On_Hold</code></td>
                            <td><span class="badge badge-blue">Sender</span></td>
                            <td><span class="badge badge-red">Delayed</span></td>
                            <td>On Hold</td>
                            <td>Resume</td>
                            <td>-</td>
                            <td>Direct API</td>
                        </tr>
                        <tr>
                            <td><code>On_Hold</code></td>
                            <td><span class="badge badge-orange">Receiver</span></td>
                            <td><span class="badge badge-red">Delayed</span></td>
                            <td>On Hold</td>
                            <td>Resume Work</td>
                            <td>-</td>
                            <td>Direct API</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <div class="card-title">Proposed TypeScript Interface</div>
                <pre><code><span class="comment">// src/lib/workflow/requirementCTA.ts</span>

<span class="keyword">export interface</span> <span class="type">CTAConfig</span> {
  displayStatus: <span class="type">string</span>;
  isPending: <span class="type">boolean</span>;
  primaryAction?: {
    label: <span class="type">string</span>;
    type: <span class="string">'Approve'</span> | <span class="string">'Reject'</span> | <span class="string">'Submit'</span> | <span class="string">'Edit'</span> | <span class="string">'Map'</span> | <span class="string">'Revise'</span>;
    modal?: <span class="string">'quotation'</span> | <span class="string">'reject'</span> | <span class="string">'mapping'</span> | <span class="string">'edit'</span> | <span class="string">'none'</span>;
    apiAction?: <span class="type">string</span>; <span class="comment">// For direct API calls without modal</span>
  };
  secondaryAction?: {
    label: <span class="type">string</span>;
    type: <span class="type">string</span>;
    modal?: <span class="type">string</span>;
  };
}

<span class="keyword">export function</span> getCTAConfig(
  status: <span class="type">RequirementStatus</span>,
  role: <span class="string">'sender'</span> | <span class="string">'receiver'</span> | <span class="string">'internal'</span>,
  context: {
    isWorkspaceMapped?: <span class="type">boolean</span>;
    updatedByCurrentUser?: <span class="type">boolean</span>;
  }
): <span class="type">CTAConfig</span> {
  <span class="comment">// Centralized CTA logic here</span>
}</code></pre>
            </div>
        </section>

        <!-- Section 7: Modal Configuration -->
        <section id="modal-config">
            <h2>Modal Configuration</h2>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-title">QuotationDialog</div>
                    <div class="card-subtitle">Used for quote submission and revision</div>
                    
                    <h4>Trigger Conditions</h4>
                    <ul style="color: var(--text-secondary); font-size: 14px; padding-left: 20px;">
                        <li>Receiver + Status: <code>Waiting</code></li>
                        <li>Receiver + Status: <code>Rejected</code> (revise quote)</li>
                    </ul>
                    
                    <h4>Fields (Dynamic)</h4>
                    <table>
                        <thead><tr><th>Field</th><th>Condition</th></tr></thead>
                        <tbody>
                            <tr><td>Hourly Rate</td><td><code>pricingModel === 'hourly'</code></td></tr>
                            <tr><td>Estimated Hours</td><td><code>pricingModel === 'hourly'</code></td></tr>
                            <tr><td>Total Project Cost</td><td><code>pricingModel === 'project'</code></td></tr>
                            <tr><td>Currency</td><td>Always</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-title">RejectDialog</div>
                    <div class="card-subtitle">Used for quote/work rejection with reason</div>
                    
                    <h4>Trigger Conditions</h4>
                    <ul style="color: var(--text-secondary); font-size: 14px; padding-left: 20px;">
                        <li>Receiver + Status: <code>Waiting</code> (decline)</li>
                        <li>Sender + Status: <code>Submitted</code> (reject quote)</li>
                        <li>Sender + Status: <code>Review</code> (request revision)</li>
                    </ul>
                    
                    <h4>Fields</h4>
                    <table>
                        <thead><tr><th>Field</th><th>Required</th></tr></thead>
                        <tbody>
                            <tr><td>Rejection Reason</td><td>Yes</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-title">InternalMappingModal</div>
                <div class="card-subtitle">Used for mapping outsourced requirements to receiver's workspace</div>
                
                <h4>Trigger Conditions</h4>
                <ul style="color: var(--text-secondary); font-size: 14px; padding-left: 20px;">
                    <li>Receiver + Status: <code>Assigned</code> + <code>!receiver_workspace_id</code></li>
                </ul>
                
                <h4>Fields</h4>
                <table>
                    <thead><tr><th>Field</th><th>Type</th><th>Notes</th></tr></thead>
                    <tbody>
                        <tr><td>Internal Workspace</td><td>Select</td><td>Filtered to receiver's workspaces only</td></tr>
                        <tr><td>Create New Workspace</td><td>Action</td><td>Opens WorkspaceForm inline</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 8: Implementation Guide -->
        <section id="implementation">
            <h2>Implementation Guide</h2>
            
            <div class="highlight-box">
                <h4>Recommended File Structure</h4>
                <pre style="background: transparent; border: none; padding: 0; margin: 8px 0 0;"><code>src/lib/workflow/
├── index.ts                          <span class="comment"># Public exports</span>
├── requirementWorkflow.ts            <span class="comment"># State machine + transitions</span>
├── requirementWorkflow.types.ts      <span class="comment"># TypeScript types</span>
├── requirementCTA.ts                 <span class="comment"># CTA mapping per state/role</span>
├── requirementModalConfig.ts         <span class="comment"># Modal field configurations</span>
└── requirementTabMapping.ts          <span class="comment"># Tab determination logic</span></code></pre>
            </div>

            <div class="implementation-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Create Type Definitions</h4>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        Define <code>RequirementStatus</code>, <code>UserRole</code>, <code>CTAConfig</code>, and <code>TransitionRule</code> types.
                        Mirror the backend's Prisma enum for consistency.
                    </p>
                </div>
            </div>

            <div class="implementation-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Implement State Machine</h4>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        Create <code>VALID_TRANSITIONS</code> record matching backend's <code>RequirementWorkflowManager</code>.
                        Include helper functions: <code>isTransitionValid()</code>, <code>getAllowedTransitions()</code>.
                    </p>
                </div>
            </div>

            <div class="implementation-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>Centralize CTA Logic</h4>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        Move all CTA determination from <code>RequirementCard</code> and <code>RequirementsPage</code> to 
                        <code>getCTAConfig()</code> function. Components become pure renderers.
                    </p>
                </div>
            </div>

            <div class="implementation-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Migrate Components</h4>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        Update <code>RequirementCard</code>, <code>RequirementsPage</code>, and <code>RequirementDetailsPage</code> 
                        to consume the workflow module. Remove inline business logic.
                    </p>
                </div>
            </div>

            <div class="implementation-step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>Add Unit Tests</h4>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        Test all state transitions and CTA mappings. Pure functions are easily testable.
                        Ensure coverage for edge cases (rejection by whom, workspace mapping states).
                    </p>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Example Implementation</div>
                <pre><code><span class="comment">// src/lib/workflow/requirementWorkflow.ts</span>

<span class="keyword">import</span> { RequirementStatus, UserRole, CTAConfig } <span class="keyword">from</span> <span class="string">'./requirementWorkflow.types'</span>;

<span class="comment">/** 
 * State machine matching backend RequirementWorkflowManager
 * Single source of truth for frontend workflow logic
 */</span>
<span class="keyword">export const</span> SENDER_TRANSITIONS: <span class="type">Record&lt;RequirementStatus, RequirementStatus[]&gt;</span> = {
  Waiting: [<span class="string">'On_Hold'</span>, <span class="string">'Rejected'</span>],
  Submitted: [<span class="string">'Assigned'</span>, <span class="string">'Rejected'</span>],
  Review: [<span class="string">'Completed'</span>, <span class="string">'Revision'</span>],
  Rejected: [<span class="string">'Waiting'</span>],
  Completed: [<span class="string">'Revision'</span>, <span class="string">'Rejected'</span>],
  <span class="comment">// ... other statuses</span>
};

<span class="keyword">export const</span> RECEIVER_TRANSITIONS: <span class="type">Record&lt;RequirementStatus, RequirementStatus[]&gt;</span> = {
  Waiting: [<span class="string">'Submitted'</span>, <span class="string">'Rejected'</span>],
  Submitted: [<span class="string">'Waiting'</span>],
  Rejected: [<span class="string">'Submitted'</span>],
  Assigned: [<span class="string">'In_Progress'</span>],
  In_Progress: [<span class="string">'Review'</span>, <span class="string">'Impediment'</span>, <span class="string">'Stuck'</span>, <span class="string">'On_Hold'</span>],
  Review: [<span class="string">'In_Progress'</span>],
  Revision: [<span class="string">'Review'</span>, <span class="string">'In_Progress'</span>],
  <span class="comment">// ... other statuses</span>
};

<span class="keyword">export function</span> isTransitionValid(
  from: <span class="type">RequirementStatus</span>,
  to: <span class="type">RequirementStatus</span>,
  role: <span class="type">UserRole</span>
): <span class="type">boolean</span> {
  <span class="keyword">const</span> transitions = role === <span class="string">'sender'</span> 
    ? SENDER_TRANSITIONS 
    : RECEIVER_TRANSITIONS;
  <span class="keyword">return</span> transitions[from]?.includes(to) ?? <span class="keyword">false</span>;
}

<span class="keyword">export function</span> getAllowedTransitions(
  status: <span class="type">RequirementStatus</span>,
  role: <span class="type">UserRole</span>
): <span class="type">RequirementStatus[]</span> {
  <span class="keyword">const</span> transitions = role === <span class="string">'sender'</span> 
    ? SENDER_TRANSITIONS 
    : RECEIVER_TRANSITIONS;
  <span class="keyword">return</span> transitions[status] ?? [];
}</code></pre>
            </div>
        </section>

        <footer style="text-align: center; padding: 60px 0; border-top: 1px solid var(--border-color); margin-top: 80px;">
            <p style="color: var(--text-muted); font-size: 14px;">
                AlsoNotify Requirements Workflow Specification v2.0<br>
                Generated January 2026
            </p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#21262d',
                primaryTextColor: '#e6edf3',
                primaryBorderColor: '#30363d',
                lineColor: '#8b949e',
                secondaryColor: '#161b22',
                tertiaryColor: '#0d1117',
                fontFamily: 'Inter, sans-serif'
            },
            flowchart: {
                curve: 'basis',
                padding: 20
            },
            sequence: {
                diagramMarginX: 20,
                diagramMarginY: 20,
                actorMargin: 50,
                width: 180,
                height: 50,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35
            }
        });
    </script>
</body>
</html>
